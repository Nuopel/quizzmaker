<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Quiz</title>
    <style>
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        #quiz-info {
            color: #666;
            font-size: 1.1em;
            margin-top: 10px;
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.85em;
            font-weight: 600;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 6px solid #667eea;
            transition: all 0.3s ease;
        }

        .question-card.answered-correct {
            background: #d4edda;
            border-left-color: #28a745;
        }

        .question-card.answered-incorrect {
            background: #f8d7da;
            border-left-color: #dc3545;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85em;
        }

        .badge-section {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-easy {
            background: #d4edda;
            color: #155724;
        }

        .badge-medium {
            background: #fff3cd;
            color: #856404;
        }

        .badge-hard {
            background: #f8d7da;
            color: #721c24;
        }

        .question-text {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .options {
            margin-bottom: 20px;
        }

        .option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
        }

        .option:hover:not(.disabled) {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateX(5px);
        }

        .option input[type="radio"] {
            margin-right: 12px;
            cursor: pointer;
            width: 20px;
            height: 20px;
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .short-answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 20px;
        }

        .short-answer-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .submit-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #d4edda;
            border: 2px solid #28a745;
        }

        .feedback.incorrect {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }

        .feedback-header {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .feedback.correct .feedback-header {
            color: #155724;
        }

        .feedback.incorrect .feedback-header {
            color: #721c24;
        }

        .explanation {
            color: #333;
            font-size: 1em;
            line-height: 1.6;
        }

        #navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            flex-wrap: wrap;
            gap: 15px;
        }

        #page-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        #navigation button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #navigation button:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
        }

        #navigation button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        #page-info {
            color: #666;
            font-weight: 600;
        }

        #results-container {
            margin-top: 40px;
        }

        #results-container h2 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2em;
        }

        .score-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-summary .score {
            font-size: 4em;
            font-weight: bold;
            margin: 20px 0;
        }

        .score-summary .percentage {
            font-size: 2em;
        }

        .performance-breakdown {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .performance-breakdown h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .difficulty-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            text-align: center;
        }

        .stat-card h4 {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .question-review {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
        }

        .question-review h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .review-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #e0e0e0;
        }

        .review-item.correct {
            border-left-color: #28a745;
        }

        .review-item.incorrect {
            border-left-color: #dc3545;
        }

        .review-question {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .review-answer {
            color: #666;
            font-size: 0.95em;
        }

        .hidden {
            display: none !important;
        }

        .submit-all-btn {
            background: #28a745 !important;
            margin-left: 20px;
        }

        .submit-all-btn:hover:not(:disabled) {
            background: #218838 !important;
        }

        .restart-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .restart-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>📝 Interactive Quiz</h1>
            <div id="quiz-info"></div>
        </header>

        <div id="quiz-container">
            <!-- Questions will be rendered here -->
        </div>

        <div id="navigation">
            <div id="page-navigation">
                <button id="prev-btn" onclick="previousPage()">← Previous Page</button>
                <span id="page-info"></span>
                <button id="next-btn" onclick="nextPage()">Next Page →</button>
            </div>
            <button id="submit-all-btn" onclick="showResults()" class="submit-all-btn">🎯 Submit All & Review</button>
        </div>

        <div id="results-container" style="display: none;">
            <h2>🎯 Quiz Results</h2>
            <div id="results-content"></div>
        </div>
    </div>

    <script>
        // Quiz data
        const questions = [{"id": 3, "section": "1.3", "section_title": "Opérateurs", "difficulty": "Easy", "type": "True/False", "question": "L'opérateur '==' vérifie l'égalité de valeur entre deux objets.", "options": ["True", "False"], "answer": "True", "explanation": "L'opérateur '==' compare les valeurs, tandis que 'is' compare les identités."}, {"id": 7, "section": "3.2", "section_title": "Héritage", "difficulty": "Medium", "type": "True/False", "question": "Une classe peut hériter de plusieurs classes parentes en Python (héritage multiple).", "options": ["True", "False"], "answer": "True", "explanation": "Python supporte l'héritage multiple, contrairement à certains langages comme Java."}, {"id": 8, "section": "3.3", "section_title": "Décorateurs", "difficulty": "Hard", "type": "Short Answer", "question": "Qu'est-ce qu'un décorateur en Python et à quoi sert-il?", "options": [], "answer": "Un décorateur est une fonction qui modifie le comportement d'une autre fonction. Il permet d'ajouter des fonctionnalités sans modifier le code original.", "explanation": "Les décorateurs utilisent la syntaxe @decorator_name et sont très utiles pour le logging, la validation, le caching, etc."}, {"id": 4, "section": "2.1", "section_title": "Structures de contrôle", "difficulty": "Medium", "type": "Multiple Choice", "question": "Quelle est la sortie de: [x**2 for x in range(3)]?", "options": ["[0, 1, 2]", "[0, 1, 4]", "[1, 2, 3]", "[1, 4, 9]"], "answer": "[0, 1, 4]", "explanation": "La list comprehension calcule le carré de 0, 1, et 2: [0², 1², 2²] = [0, 1, 4]."}, {"id": 6, "section": "3.1", "section_title": "Programmation orientée objet", "difficulty": "Hard", "type": "Multiple Choice", "question": "Quelle méthode est appelée automatiquement lors de la création d'un objet?", "options": ["__create__", "__init__", "__new__", "__start__"], "answer": "__init__", "explanation": "__init__ est le constructeur appelé après la création de l'objet par __new__."}, {"id": 5, "section": "2.2", "section_title": "Fonctions avancées", "difficulty": "Medium", "type": "Short Answer", "question": "Expliquez la différence entre *args et **kwargs dans une fonction Python.", "options": [], "answer": "*args permet de passer un nombre variable d'arguments positionnels (tuple), **kwargs permet de passer un nombre variable d'arguments nommés (dictionnaire).", "explanation": "*args collecte les arguments positionnels en tuple, **kwargs collecte les arguments nommés en dictionnaire."}, {"id": 1, "section": "1.1", "section_title": "Introduction à Python", "difficulty": "Easy", "type": "Multiple Choice", "question": "Quel mot-clé est utilisé pour définir une fonction en Python?", "options": ["function", "def", "func", "define"], "answer": "def", "explanation": "Le mot-clé 'def' (definition) est utilisé pour définir une fonction en Python."}, {"id": 2, "section": "1.2", "section_title": "Types de données", "difficulty": "Easy", "type": "Multiple Choice", "question": "Quel type de données Python est mutable?", "options": ["tuple", "string", "list", "int"], "answer": "list", "explanation": "Les listes sont mutables, contrairement aux tuples et strings qui sont immuables."}];
        const questionsPerPage = 8;
        const totalPages = 1;

        
        // State management
        let currentPage = 1;
        let userAnswers = {}; // { questionId: { answer, isCorrect, submitted } }

        // Initialize quiz
        document.addEventListener('DOMContentLoaded', function() {
            initializeQuiz();
            renderCurrentPage();
        });

        function initializeQuiz() {
            // Initialize answer state for all questions
            questions.forEach(q => {
                userAnswers[q.id] = {
                    answer: null,
                    isCorrect: false,
                    submitted: false
                };
            });

            // Update quiz info with progress bar
            updateQuizInfo();
        }

        function updateQuizInfo() {
            const answered = Object.values(userAnswers).filter(state => state.submitted).length;
            const total = questions.length;
            const percentage = total > 0 ? (answered / total * 100).toFixed(0) : 0;

            document.getElementById('quiz-info').innerHTML = `
                <div>Total Questions: ${total} | Pages: ${totalPages} | Answered: ${answered}/${total}</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${percentage}%">
                        ${percentage}%
                    </div>
                </div>
            `;
        }

        function renderCurrentPage() {
            const startIdx = (currentPage - 1) * questionsPerPage;
            const endIdx = Math.min(startIdx + questionsPerPage, questions.length);
            const pageQuestions = questions.slice(startIdx, endIdx);

            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            pageQuestions.forEach((q, idx) => {
                const questionNum = startIdx + idx + 1;
                container.appendChild(createQuestionCard(q, questionNum));
            });

            updateNavigation();
        }

        function createQuestionCard(question, questionNum) {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.id = `question-${question.id}`;

            // Check if already answered
            const state = userAnswers[question.id];
            if (state.submitted) {
                card.classList.add(state.isCorrect ? 'answered-correct' : 'answered-incorrect');
            }

            // Difficulty badge class
            const difficultyClass = `badge-${question.difficulty.toLowerCase()}`;

            card.innerHTML = `
                <div class="question-header">
                    <div class="question-meta">
                        <span class="badge badge-section">${question.section}: ${question.section_title}</span>
                        <span class="badge ${difficultyClass}">${question.difficulty}</span>
                    </div>
                    <span style="color: #999; font-weight: 600;">Question ${questionNum}/${questions.length}</span>
                </div>
                <div class="question-text">${question.question}</div>
                ${renderQuestionInput(question)}
                <button class="submit-btn" onclick="submitAnswer(${question.id})"
                    ${state.submitted ? 'disabled' : ''}>
                    ${state.submitted ? '✓ Submitted' : 'Submit Answer'}
                </button>
                <div class="feedback" id="feedback-${question.id}">
                    <div class="feedback-header"></div>
                    <div class="explanation"></div>
                </div>
            `;

            return card;
        }

        function renderQuestionInput(question) {
            const state = userAnswers[question.id];

            if (question.type === 'Multiple Choice') {
                return `
                    <div class="options">
                        ${question.options.map((opt, idx) => {
                            const letter = String.fromCharCode(65 + idx);
                            const optionId = `q${question.id}_opt${idx}`;
                            const isUserAnswer = state.answer === opt;
                            const isCorrect = opt === question.answer;

                            let optionClass = 'option';
                            if (state.submitted) {
                                optionClass += ' disabled';
                                if (isUserAnswer && isCorrect) optionClass += ' correct';
                                if (isUserAnswer && !isCorrect) optionClass += ' incorrect';
                                if (!isUserAnswer && isCorrect) optionClass += ' correct';
                            }

                            return `
                                <label class="${optionClass}">
                                    <input type="radio" name="q${question.id}" value="${opt}"
                                        id="${optionId}" ${state.submitted ? 'disabled' : ''}
                                        ${isUserAnswer ? 'checked' : ''}>
                                    <span>${letter}) ${opt}</span>
                                </label>
                            `;
                        }).join('')}
                    </div>
                `;
            } else if (question.type === 'True/False') {
                const options = ['True', 'False'];
                return `
                    <div class="options">
                        ${options.map((opt, idx) => {
                            const letter = String.fromCharCode(65 + idx);
                            const optionId = `q${question.id}_opt${idx}`;
                            const isUserAnswer = state.answer === opt;
                            const isCorrect = opt === question.answer;

                            let optionClass = 'option';
                            if (state.submitted) {
                                optionClass += ' disabled';
                                if (isUserAnswer && isCorrect) optionClass += ' correct';
                                if (isUserAnswer && !isCorrect) optionClass += ' incorrect';
                                if (!isUserAnswer && isCorrect) optionClass += ' correct';
                            }

                            return `
                                <label class="${optionClass}">
                                    <input type="radio" name="q${question.id}" value="${opt}"
                                        id="${optionId}" ${state.submitted ? 'disabled' : ''}
                                        ${isUserAnswer ? 'checked' : ''}>
                                    <span>${letter}) ${opt}</span>
                                </label>
                            `;
                        }).join('')}
                    </div>
                `;
            } else { // Short Answer
                return `
                    <input type="text" class="short-answer-input" id="input-${question.id}"
                        placeholder="Type your answer here..."
                        ${state.submitted ? 'disabled' : ''}
                        value="${state.answer || ''}">
                `;
            }
        }

        function submitAnswer(questionId) {
            const question = questions.find(q => q.id === questionId);
            const state = userAnswers[questionId];

            // Prevent double submission
            if (state.submitted) return;

            // Get user answer
            let userAnswer;
            if (question.type === 'Short Answer') {
                userAnswer = document.getElementById(`input-${questionId}`).value.trim();
            } else {
                const selected = document.querySelector(`input[name="q${questionId}"]:checked`);
                if (!selected) {
                    alert('Please select an answer before submitting.');
                    return;
                }
                userAnswer = selected.value;
            }

            if (!userAnswer) {
                alert('Please provide an answer before submitting.');
                return;
            }

            // Check correctness
            const isCorrect = userAnswer.toLowerCase() === question.answer.toLowerCase();

            // Update state
            state.answer = userAnswer;
            state.isCorrect = isCorrect;
            state.submitted = true;

            // Show feedback
            displayFeedback(questionId, isCorrect, question.answer, question.explanation);

            // Update UI
            const card = document.getElementById(`question-${questionId}`);
            card.classList.add(isCorrect ? 'answered-correct' : 'answered-incorrect');

            // Disable submit button
            const btn = card.querySelector('.submit-btn');
            btn.disabled = true;
            btn.textContent = '✓ Submitted';

            // Disable inputs
            if (question.type === 'Short Answer') {
                document.getElementById(`input-${questionId}`).disabled = true;
            } else {
                document.querySelectorAll(`input[name="q${questionId}"]`).forEach(input => {
                    input.disabled = true;
                });
            }

            // Update option styling for MC/TF
            if (question.type !== 'Short Answer') {
                document.querySelectorAll(`input[name="q${questionId}"]`).forEach(input => {
                    const label = input.parentElement;
                    label.classList.add('disabled');

                    if (input.value === question.answer) {
                        label.classList.add('correct');
                    } else if (input.checked && input.value !== question.answer) {
                        label.classList.add('incorrect');
                    }
                });
            }

            // Update progress indicator
            updateQuizInfo();

            // Check if all questions answered
            checkQuizCompletion();
        }

        function displayFeedback(questionId, isCorrect, correctAnswer, explanation) {
            const feedback = document.getElementById(`feedback-${questionId}`);
            const header = feedback.querySelector('.feedback-header');
            const explanationDiv = feedback.querySelector('.explanation');

            feedback.classList.add('show');
            feedback.classList.add(isCorrect ? 'correct' : 'incorrect');

            header.textContent = isCorrect ? '✓ Correct!' : `✗ Incorrect. The correct answer is: ${correctAnswer}`;
            explanationDiv.innerHTML = `<strong>Explanation:</strong> ${explanation}`;
        }

        function checkQuizCompletion() {
            const allAnswered = Object.values(userAnswers).every(state => state.submitted);

            if (allAnswered) {
                // Add "Show Results" button to navigation
                const nav = document.getElementById('navigation');
                if (!document.getElementById('show-results-btn')) {
                    const resultsBtn = document.createElement('button');
                    resultsBtn.id = 'show-results-btn';
                    resultsBtn.textContent = '🎯 Show Results';
                    resultsBtn.style.background = '#28a745';
                    resultsBtn.onclick = showResults;
                    nav.appendChild(resultsBtn);
                }
            }
        }

        function showResults() {
            // Calculate score
            const totalQuestions = questions.length;
            const answeredQuestions = Object.values(userAnswers).filter(state => state.submitted).length;
            const unansweredQuestions = totalQuestions - answeredQuestions;
            const correctAnswers = Object.values(userAnswers).filter(state => state.isCorrect).length;
            const incorrectAnswers = answeredQuestions - correctAnswers;
            const percentage = answeredQuestions > 0 ? ((correctAnswers / answeredQuestions) * 100).toFixed(1) : 0;
            const overallPercentage = ((correctAnswers / totalQuestions) * 100).toFixed(1);

            // Calculate performance by difficulty
            const byDifficulty = {};
            questions.forEach(q => {
                if (!byDifficulty[q.difficulty]) {
                    byDifficulty[q.difficulty] = { correct: 0, incorrect: 0, unanswered: 0, total: 0 };
                }
                byDifficulty[q.difficulty].total++;
                const state = userAnswers[q.id];
                if (state.submitted) {
                    if (state.isCorrect) {
                        byDifficulty[q.difficulty].correct++;
                    } else {
                        byDifficulty[q.difficulty].incorrect++;
                    }
                } else {
                    byDifficulty[q.difficulty].unanswered++;
                }
            });

            // Calculate performance by section
            const bySection = {};
            questions.forEach(q => {
                const sectionKey = `${q.section}: ${q.section_title}`;
                if (!bySection[sectionKey]) {
                    bySection[sectionKey] = { correct: 0, incorrect: 0, unanswered: 0, total: 0 };
                }
                bySection[sectionKey].total++;
                const state = userAnswers[q.id];
                if (state.submitted) {
                    if (state.isCorrect) {
                        bySection[sectionKey].correct++;
                    } else {
                        bySection[sectionKey].incorrect++;
                    }
                } else {
                    bySection[sectionKey].unanswered++;
                }
            });

            // Performance rating
            let rating;
            if (percentage >= 90) rating = 'Excellent! 🌟';
            else if (percentage >= 80) rating = 'Very Good! 👏';
            else if (percentage >= 70) rating = 'Good! 👍';
            else if (percentage >= 60) rating = 'Passable 📚';
            else rating = 'Keep Studying! 💪';

            // Generate results HTML
            let resultsHTML = `
                <div class="score-summary">
                    <h3>Your Score</h3>
                    <div class="score">${correctAnswers} / ${answeredQuestions}</div>
                    <div class="percentage">${percentage}% ${answeredQuestions < totalQuestions ? '(of answered)' : ''}</div>
                    <p style="font-size: 1.5em; margin-top: 20px;">${rating}</p>
                    ${unansweredQuestions > 0 ? `<p style="font-size: 1.2em; color: #ffc107;">⚠️ ${unansweredQuestions} question${unansweredQuestions > 1 ? 's' : ''} not answered</p>` : ''}
                </div>

                <div class="performance-breakdown">
                    <h3>📈 Overall Statistics</h3>
                    <div class="difficulty-stats">
                        <div class="stat-card">
                            <h4>Total Questions</h4>
                            <div class="stat-value">${totalQuestions}</div>
                        </div>
                        <div class="stat-card" style="border-left-color: #28a745;">
                            <h4>Correct</h4>
                            <div class="stat-value" style="color: #28a745;">✓ ${correctAnswers}</div>
                        </div>
                        <div class="stat-card" style="border-left-color: #dc3545;">
                            <h4>Incorrect</h4>
                            <div class="stat-value" style="color: #dc3545;">✗ ${incorrectAnswers}</div>
                        </div>
                        ${unansweredQuestions > 0 ? `
                        <div class="stat-card" style="border-left-color: #ffc107;">
                            <h4>Unanswered</h4>
                            <div class="stat-value" style="color: #ffc107;">- ${unansweredQuestions}</div>
                        </div>` : ''}
                    </div>
                </div>

                <div class="performance-breakdown">
                    <h3>📊 Performance by Difficulty</h3>
                    <div class="difficulty-stats">
            `;

            Object.keys(byDifficulty).sort().forEach(difficulty => {
                const stats = byDifficulty[difficulty];
                const answered = stats.correct + stats.incorrect;
                const percent = answered > 0 ? ((stats.correct / answered) * 100).toFixed(0) : 0;
                resultsHTML += `
                    <div class="stat-card">
                        <h4>${difficulty}</h4>
                        <div class="stat-value">${stats.correct}/${answered}</div>
                        <p style="color: #666; margin-top: 5px;">${percent}% correct</p>
                        ${stats.unanswered > 0 ? `<p style="color: #ffc107; font-size: 0.9em;">${stats.unanswered} unanswered</p>` : ''}
                    </div>
                `;
            });

            resultsHTML += `
                    </div>
                </div>

                <div class="performance-breakdown">
                    <h3>📚 Performance by Section</h3>
                    <div class="difficulty-stats">
            `;

            Object.keys(bySection).forEach(section => {
                const stats = bySection[section];
                const answered = stats.correct + stats.incorrect;
                const percent = answered > 0 ? ((stats.correct / answered) * 100).toFixed(0) : 0;
                resultsHTML += `
                    <div class="stat-card">
                        <h4>${section}</h4>
                        <div class="stat-value">${stats.correct}/${answered}</div>
                        <p style="color: #666; margin-top: 5px;">${percent}% correct</p>
                        ${stats.unanswered > 0 ? `<p style="color: #ffc107; font-size: 0.9em;">${stats.unanswered} unanswered</p>` : ''}
                    </div>
                `;
            });

            resultsHTML += `
                    </div>
                </div>

                <div class="question-review">
                    <h3>📝 Question Review</h3>
            `;

            questions.forEach((q, idx) => {
                const state = userAnswers[q.id];
                let resultClass, icon, statusText;

                if (!state.submitted) {
                    resultClass = '';
                    icon = '-';
                    statusText = 'Not answered';
                } else if (state.isCorrect) {
                    resultClass = 'correct';
                    icon = '✓';
                    statusText = '';
                } else {
                    resultClass = 'incorrect';
                    icon = '✗';
                    statusText = '';
                }

                resultsHTML += `
                    <div class="review-item ${resultClass}">
                        <div class="review-question">${icon} Question ${idx + 1}: ${q.question}</div>
                        ${state.submitted ? `
                            <div class="review-answer">Your answer: <strong>${state.answer}</strong></div>
                            ${!state.isCorrect ? `<div class="review-answer">Correct answer: <strong>${q.answer}</strong></div>` : ''}
                        ` : `
                            <div class="review-answer" style="color: #ffc107;"><strong>${statusText}</strong></div>
                            <div class="review-answer">Correct answer: <strong>${q.answer}</strong></div>
                        `}
                    </div>
                `;
            });

            resultsHTML += `
                </div>
                <button class="restart-btn" onclick="restartQuiz()">🔄 Restart Quiz</button>
            `;

            // Hide quiz, show results
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('navigation').classList.add('hidden');
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('results-content').innerHTML = resultsHTML;

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const pageInfo = document.getElementById('page-info');

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;

            pageInfo.textContent = `Page ${currentPage} / ${totalPages}`;

            // Hide page navigation if only one page, but keep Submit All button visible
            if (totalPages === 1) {
                document.getElementById('page-navigation').style.display = 'none';
            } else {
                document.getElementById('page-navigation').style.display = 'flex';
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                renderCurrentPage();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                renderCurrentPage();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function restartQuiz() {
            // Reset all answers
            questions.forEach(q => {
                userAnswers[q.id] = {
                    answer: null,
                    isCorrect: false,
                    submitted: false
                };
            });

            // Reset UI
            currentPage = 1;
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('navigation').classList.remove('hidden');

            // Remove "Show Results" button if it exists
            const showResultsBtn = document.getElementById('show-results-btn');
            if (showResultsBtn) {
                showResultsBtn.remove();
            }

            // Re-render
            updateQuizInfo();
            renderCurrentPage();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
    </script>
</body>
</html>